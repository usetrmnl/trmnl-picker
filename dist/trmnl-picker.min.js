var TRMNLPicker=(()=>{var u=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var M=(d,e)=>{for(var s in e)u(d,s,{get:e[s],enumerable:!0})},_=(d,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of g(e))!k.call(d,a)&&a!==s&&u(d,a,{get:()=>e[a],enumerable:!(t=p(e,a))||t.enumerable});return d};var P=d=>_(u({},"__esModule",{value:!0}),d);var S={};M(S,{default:()=>E});var f=class d{static API_BASE_URL="https://usetrmnl.com";static async create(e,s={}){let{models:t,palettes:a,localStorageKey:o}=s;if(!t)try{let l=await fetch(`${d.API_BASE_URL}/api/models`);if(!l.ok)throw new Error(`Failed to fetch models: ${l.status} ${l.statusText}`);let r=await l.json();t=r.data||r}catch(l){throw new Error(`TRMNLPicker: Failed to fetch models from API: ${l.message}`)}if(!a)try{let l=await fetch(`${d.API_BASE_URL}/api/palettes`);if(!l.ok)throw new Error(`Failed to fetch palettes: ${l.status} ${l.statusText}`);let r=await l.json();a=r.data||r}catch(l){throw new Error(`TRMNLPicker: Failed to fetch palettes from API: ${l.message}`)}return new d(e,{models:t,palettes:a,localStorageKey:o})}constructor(e,s={}){if(!e||typeof e!="string")throw new Error("TRMNLPicker: formId must be a non-empty string");if(this.formElement=document.getElementById(e),!this.formElement)throw new Error(`TRMNLPicker: Form element with id "${e}" not found`);let{models:t,palettes:a,localStorageKey:o}=s;if(this.models=t,this.palettes=a,this.localStorageKey=o,this.state={selectedModel:null,selectedPalette:null,isPortrait:!1,isDarkMode:!1},this.models&&this.palettes){if(!Array.isArray(this.models)||this.models.length===0)throw new Error("TRMNLPicker: models must be a non-empty array");if(!Array.isArray(this.palettes)||this.palettes.length===0)throw new Error("TRMNLPicker: palettes must be a non-empty array");if(this.models=this._filterValidModels(),this.models.length===0)throw new Error("TRMNLPicker: no valid models found (all models have palettes with empty framework_class)");this._initializeElements(),this._bindEvents(),this._setInitialState()}}_filterValidModels(){return this.models.filter(e=>e.palette_ids.some(s=>{let t=this.palettes.find(a=>a.id===s);return t&&t.framework_class&&t.framework_class.trim()!==""}))}_getFirstValidPaletteId(e){if(!e)return null;for(let s of e.palette_ids){let t=this.palettes.find(a=>a.id===s);if(t&&t.framework_class&&t.framework_class.trim()!=="")return s}return null}_initializeElements(){this.elements={modelSelect:this.formElement.querySelector("#model-select"),paletteSelect:this.formElement.querySelector("#palette-select"),orientationToggle:this.formElement.querySelector("#orientation-toggle"),darkModeToggle:this.formElement.querySelector("#dark-mode-toggle"),resetButton:this.formElement.querySelector("#reset-button"),orientationText:this.formElement.querySelector("[data-orientation-text]"),darkModeText:this.formElement.querySelector("[data-dark-mode-text]")};let e=["modelSelect","paletteSelect"];for(let s of e)if(!this.elements[s])throw new Error(`TRMNLPicker: Required element "${s}" not found in form`)}_bindEvents(){this.handlers={modelChange:this._handleModelChange.bind(this),paletteChange:this._handlePaletteChange.bind(this),orientationToggle:this._toggleOrientation.bind(this),darkModeToggle:this._toggleDarkMode.bind(this),reset:this._resetToDefaults.bind(this)},this.elements.modelSelect.addEventListener("change",this.handlers.modelChange),this.elements.paletteSelect.addEventListener("change",this.handlers.paletteChange),this.elements.orientationToggle&&this.elements.orientationToggle.addEventListener("click",this.handlers.orientationToggle),this.elements.darkModeToggle&&this.elements.darkModeToggle.addEventListener("click",this.handlers.darkModeToggle),this.elements.resetButton&&this.elements.resetButton.addEventListener("click",this.handlers.reset)}_setInitialState(){let e=this.models.filter(i=>i.kind==="trmnl"),s=this.models.filter(i=>i.kind!=="trmnl"),t=[...e].sort((i,n)=>{let h=(i.label||i.name).toLowerCase(),c=(n.label||n.name).toLowerCase();return h.localeCompare(c)}),a=[...s].sort((i,n)=>{let h=(i.label||i.name).toLowerCase(),c=(n.label||n.name).toLowerCase();return h.localeCompare(c)});if(this.elements.modelSelect.innerHTML="",t.length>0){let i=document.createElement("optgroup");i.label="TRMNL",t.forEach(n=>{let h=document.createElement("option");h.value=n.name,h.textContent=n.label||n.name,i.appendChild(h)}),this.elements.modelSelect.appendChild(i)}if(a.length>0){let i=document.createElement("optgroup");i.label="BYOD",a.forEach(n=>{let h=document.createElement("option");h.value=n.name,h.textContent=n.label||n.name,i.appendChild(h)}),this.elements.modelSelect.appendChild(i)}let o=[...t,...a],l=this._loadFromLocalStorage(),r=null;l&&l.modelName&&(r=this.models.find(i=>i.name===l.modelName)),r||(r=o.find(i=>i.name==="og"||i.label&&i.label.toLowerCase()==="trmnl og")||o.find(i=>i.name==="og_plus")||o.find(i=>i.name==="trmnl_original")||o[0]),this.elements.modelSelect.value=r.name,this.state.selectedModel=r,this._populatePalettes();let m=null;if(l&&l.paletteId){let i=this.palettes.find(n=>n.id===l.paletteId);i&&i.framework_class&&i.framework_class.trim()!==""&&r.palette_ids.includes(l.paletteId)&&(m=l.paletteId)}m||(m=this._getFirstValidPaletteId(r)),this.elements.paletteSelect.value=m,this.state.selectedPalette=this.palettes.find(i=>i.id===m),l&&(typeof l.isPortrait=="boolean"&&(this.state.isPortrait=l.isPortrait,this.elements.orientationText&&(this.elements.orientationText.textContent=this.state.isPortrait?"Portrait":"Landscape")),typeof l.isDarkMode=="boolean"&&(this.state.isDarkMode=l.isDarkMode,this.elements.darkModeText&&(this.elements.darkModeText.textContent=this.state.isDarkMode?"Dark Mode":"Light Mode"))),this._updateResetButton(),this._emitChangeEvent()}_populatePalettes(){let e=this.elements.modelSelect.value,s=this.models.find(t=>t.name===e);s&&(this.elements.paletteSelect.innerHTML="",s.palette_ids.forEach(t=>{let a=this.palettes.find(o=>o.id===t);if(a&&a.framework_class&&a.framework_class.trim()!==""){let o=document.createElement("option");o.value=a.id,o.textContent=a.name,this.elements.paletteSelect.appendChild(o)}}))}_calculateScreenClasses(){let e=this.state.selectedModel,s=this.state.selectedPalette;if(!e)throw new Error("No model selected");let t=[];return s&&s.framework_class&&t.push(s.framework_class),t.push(`screen--${e.name}`),e.size&&t.push(`screen--${e.size}`),t.push(`screen--${this.state.isPortrait?"portrait":"landscape"}`),t.push("screen--1x"),this.state.isDarkMode&&t.push("screen--dark-mode"),t}_emitChangeEvent(){let e=this.state.selectedModel,s=this.state.selectedPalette;this._saveToLocalStorage();let t=new CustomEvent("changed",{detail:{screenClasses:this._calculateScreenClasses(),state:{model:e?{name:e.name,label:e.label,size:e.size,width:e.width,height:e.height}:null,palette:s?{id:s.id,name:s.name,framework_class:s.framework_class}:null,isPortrait:this.state.isPortrait,isDarkMode:this.state.isDarkMode}},bubbles:!0});this.formElement.dispatchEvent(t)}_loadFromLocalStorage(){if(!this.localStorageKey)return null;try{let e=localStorage.getItem(this.localStorageKey);if(e)return JSON.parse(e)}catch(e){console.warn("TRMNLPicker: Failed to load from localStorage:",e)}return null}_saveToLocalStorage(){if(this.localStorageKey)try{let e={modelName:this.state.selectedModel?.name,paletteId:this.state.selectedPalette?.id,isPortrait:this.state.isPortrait,isDarkMode:this.state.isDarkMode};localStorage.setItem(this.localStorageKey,JSON.stringify(e))}catch(e){console.warn("TRMNLPicker: Failed to save to localStorage:",e)}}_handleModelChange(e){let s=e.target.value,t=this.models.find(o=>o.name===s);if(!t)return;this.state.selectedModel=t,this._populatePalettes();let a=this._getFirstValidPaletteId(t);this.elements.paletteSelect.value=a,this.state.selectedPalette=this.palettes.find(o=>o.id===a),this._updateResetButton(),this._emitChangeEvent()}_handlePaletteChange(e){let s=e.target.value,t=this.palettes.find(a=>a.id===s);this.state.selectedPalette=t,this._updateResetButton(),this._emitChangeEvent()}_toggleOrientation(){this.state.isPortrait=!this.state.isPortrait,this.elements.orientationText&&(this.elements.orientationText.textContent=this.state.isPortrait?"Portrait":"Landscape"),this._updateResetButton(),this._emitChangeEvent()}_toggleDarkMode(){this.state.isDarkMode=!this.state.isDarkMode,this.elements.darkModeText&&(this.elements.darkModeText.textContent=this.state.isDarkMode?"Dark Mode":"Light Mode"),this._updateResetButton(),this._emitChangeEvent()}_resetToDefaults(){let e=this.state.selectedModel;if(!e)return;let s=this._getFirstValidPaletteId(e);this.elements.paletteSelect.value=s,this.state.selectedPalette=this.palettes.find(t=>t.id===s),this.state.isPortrait=!1,this.elements.orientationText&&(this.elements.orientationText.textContent="Landscape"),this.state.isDarkMode=!1,this.elements.darkModeText&&(this.elements.darkModeText.textContent="Light Mode"),this._updateResetButton(),this._emitChangeEvent()}_updateResetButton(){if(!this.elements.resetButton)return;let e=this.state.selectedModel;if(!e)return;let s=this._getFirstValidPaletteId(e),t=this.elements.paletteSelect.value===String(s),a=this.state.isPortrait===!1,o=this.state.isDarkMode===!1,l=t&&a&&o;this.elements.resetButton.disabled=l,l?(this.elements.resetButton.classList.add("opacity-50","cursor-default"),this.elements.resetButton.setAttribute("aria-disabled","true")):(this.elements.resetButton.classList.remove("opacity-50","cursor-default"),this.elements.resetButton.removeAttribute("aria-disabled"))}update(e){if(!e||typeof e!="object")throw new Error("TRMNLPicker.update: config must be an object");let s=!1;if(e.modelName){let t=this.models.find(a=>a.name===e.modelName);t&&(this.elements.modelSelect.value=t.name,this.state.selectedModel=t,this._populatePalettes(),s=!0)}if(e.paletteId){let t=this.palettes.find(a=>a.id===e.paletteId);t&&(this.elements.paletteSelect.value=t.id,this.state.selectedPalette=t,s=!0)}typeof e.isPortrait=="boolean"&&(this.state.isPortrait=e.isPortrait,this.elements.orientationText&&(this.elements.orientationText.textContent=this.state.isPortrait?"Portrait":"Landscape"),s=!0),typeof e.isDarkMode=="boolean"&&(this.state.isDarkMode=e.isDarkMode,this.elements.darkModeText&&(this.elements.darkModeText.textContent=this.state.isDarkMode?"Dark Mode":"Light Mode"),s=!0),s&&(this._updateResetButton(),this._emitChangeEvent())}getState(){return{model:this.state.selectedModel,palette:this.state.selectedPalette,isPortrait:this.state.isPortrait,isDarkMode:this.state.isDarkMode,screenClasses:this._calculateScreenClasses()}}destroy(){this.elements.modelSelect.removeEventListener("change",this.handlers.modelChange),this.elements.paletteSelect.removeEventListener("change",this.handlers.paletteChange),this.elements.orientationToggle&&this.elements.orientationToggle.removeEventListener("click",this.handlers.orientationToggle),this.elements.darkModeToggle&&this.elements.darkModeToggle.removeEventListener("click",this.handlers.darkModeToggle),this.elements.resetButton&&this.elements.resetButton.removeEventListener("click",this.handlers.reset),this.formElement=null,this.elements=null,this.handlers=null,this.models=null,this.palettes=null,this.state=null}},E=f;return P(S);})();
TRMNLPicker=TRMNLPicker.default;
//# sourceMappingURL=trmnl-picker.min.js.map
