var TRMNLPicker=(()=>{var c=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var p=Object.prototype.hasOwnProperty;var _=(n,e)=>{for(var s in e)c(n,s,{get:e[s],enumerable:!0})},k=(n,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of g(e))!p.call(n,a)&&a!==s&&c(n,a,{get:()=>e[a],enumerable:!(t=u(e,a))||t.enumerable});return n};var M=n=>k(c({},"__esModule",{value:!0}),n);var w={};_(w,{default:()=>P});var E="og_plus",m="trmnl-picker-api-cache";var f=class n{static API_BASE_URL="https://usetrmnl.com";static _getCachedApiData(){try{let e=localStorage.getItem(m);if(!e)return null;let{timestamp:s,models:t,palettes:a}=JSON.parse(e);return Date.now()-s>864e5?(localStorage.removeItem(m),null):{models:t,palettes:a}}catch(e){return console.warn("TRMNLPicker: Failed to read API cache:",e),null}}static _setCachedApiData(e,s){try{let t={timestamp:Date.now(),models:e,palettes:s};localStorage.setItem(m,JSON.stringify(t))}catch(t){console.warn("TRMNLPicker: Failed to save API cache:",t)}}static async create(e,s={}){let{models:t,palettes:a,localStorageKey:i}=s;if(!t&&!a){let o=n._getCachedApiData();o&&(t=o.models,a=o.palettes)}if(!t)try{let o=await fetch(`${n.API_BASE_URL}/api/models`);if(!o.ok)throw new Error(`Failed to fetch models: ${o.status} ${o.statusText}`);let l=await o.json();t=l.data||l}catch(o){throw new Error(`TRMNLPicker: Failed to fetch models from API: ${o.message}`)}if(!a)try{let o=await fetch(`${n.API_BASE_URL}/api/palettes`);if(!o.ok)throw new Error(`Failed to fetch palettes: ${o.status} ${o.statusText}`);let l=await o.json();a=l.data||l}catch(o){throw new Error(`TRMNLPicker: Failed to fetch palettes from API: ${o.message}`)}return!s.models&&!s.palettes&&n._setCachedApiData(t,a),new n(e,{models:t,palettes:a,localStorageKey:i})}constructor(e,s={}){if(!e)throw new Error("TRMNLPicker: formIdOrElement is required");if(typeof e=="string"){if(this.formElement=document.getElementById(e),!this.formElement)throw new Error(`TRMNLPicker: Form element with id "${e}" not found`)}else if(e instanceof Element)this.formElement=e;else throw new Error("TRMNLPicker: formIdOrElement must be a string ID or DOM element");let{models:t,palettes:a,localStorageKey:i}=s;if(this.models=t,this.palettes=a,this.localStorageKey=i,this.models&&this.palettes){if(!Array.isArray(this.models)||this.models.length===0)throw new Error("TRMNLPicker: models must be a non-empty array");if(!Array.isArray(this.palettes)||this.palettes.length===0)throw new Error("TRMNLPicker: palettes must be a non-empty array");if(this.models=this._filterValidModels(),this.models.length===0)throw new Error("TRMNLPicker: no valid models found (all models have palettes with empty framework_class)");this._initializeElements(),this._bindEvents(),this._setInitialState()}}_filterValidModels(){return this.models.filter(e=>e.palette_ids.some(s=>{let t=this.palettes.find(a=>a.id===s);return t&&t.framework_class&&t.framework_class.trim()!==""}))}_getFirstValidPaletteId(e){if(!e)return null;for(let s of e.palette_ids){let t=this.palettes.find(a=>a.id===s);if(t&&t.framework_class&&t.framework_class.trim()!=="")return s}return null}_initializeElements(){this.elements={modelSelect:this.formElement.querySelector("[data-model-select]"),paletteSelect:this.formElement.querySelector("[data-palette-select]"),orientationToggle:this.formElement.querySelector("[data-orientation-toggle]"),darkModeToggle:this.formElement.querySelector("[data-dark-mode-toggle]"),resetButton:this.formElement.querySelector("[data-reset-button]"),orientationText:this.formElement.querySelector("[data-orientation-text]"),darkModeText:this.formElement.querySelector("[data-dark-mode-text]")};let e=["modelSelect","paletteSelect"];for(let s of e)if(!this.elements[s])throw new Error(`TRMNLPicker: Required element "${s}" not found in form`)}_bindEvents(){this.handlers={modelChange:this._handleModelChange.bind(this),paletteChange:this._handlePaletteChange.bind(this),orientationToggle:this._toggleOrientation.bind(this),darkModeToggle:this._toggleDarkMode.bind(this),reset:this._resetToModelDefaults.bind(this)},this.elements.modelSelect.addEventListener("change",this.handlers.modelChange),this.elements.paletteSelect.addEventListener("change",this.handlers.paletteChange),this.elements.orientationToggle&&this.elements.orientationToggle.addEventListener("click",this.handlers.orientationToggle),this.elements.darkModeToggle&&this.elements.darkModeToggle.addEventListener("click",this.handlers.darkModeToggle),this.elements.resetButton&&this.elements.resetButton.addEventListener("click",this.handlers.reset)}_setInitialState(){let e=this.models.filter(l=>l.kind==="trmnl"),s=this.models.filter(l=>l.kind!=="trmnl"),t=[...e].sort((l,r)=>{let d=(l.label||l.name).toLowerCase(),h=(r.label||r.name).toLowerCase();return d.localeCompare(h)}),a=[...s].sort((l,r)=>{let d=(l.label||l.name).toLowerCase(),h=(r.label||r.name).toLowerCase();return d.localeCompare(h)});if(this.elements.modelSelect.innerHTML="",t.length>0){let l=document.createElement("optgroup");l.label="TRMNL",t.forEach(r=>{let d=document.createElement("option");d.value=r.name,d.textContent=r.label||r.name,l.appendChild(d)}),this.elements.modelSelect.appendChild(l)}if(a.length>0){let l=document.createElement("optgroup");l.label="BYOD",a.forEach(r=>{let d=document.createElement("option");d.value=r.name,d.textContent=r.label||r.name,l.appendChild(d)}),this.elements.modelSelect.appendChild(l)}let i=[...t,...a];this._state={};let o=this._loadFromLocalStorage();if(o)this._setParams("constructor",o);else{let l=i.find(d=>d.name===E)||i[0],r=this._getFirstValidPaletteId(l);this._setParams("constructor",{modelName:l.name,paletteId:r,isPortrait:!1,isDarkMode:!1})}}_populateModelPalettes(){let e=this.elements.modelSelect.value,s=this.models.find(t=>t.name===e);s&&(this.elements.paletteSelect.innerHTML="",s.palette_ids.forEach(t=>{let a=this.palettes.find(i=>i.id===t);if(a&&a.framework_class&&a.framework_class.trim()!==""){let i=document.createElement("option");i.value=a.id,i.textContent=a.name,this.elements.paletteSelect.appendChild(i)}}))}_emitChangeEvent(e){this._saveToLocalStorage();let s=new CustomEvent("trmnl:change",{detail:{origin:e,...this.state},bubbles:!0});this.formElement.dispatchEvent(s)}_loadFromLocalStorage(){if(!this.localStorageKey)return null;try{let e=localStorage.getItem(this.localStorageKey);if(e)return JSON.parse(e)}catch(e){console.warn("TRMNLPicker: Failed to load from localStorage:",e)}return null}_saveToLocalStorage(){if(this.localStorageKey)try{localStorage.setItem(this.localStorageKey,JSON.stringify(this.params))}catch(e){console.warn("TRMNLPicker: Failed to save to localStorage:",e)}}_handleModelChange(e){this._setParams("form",{modelName:e.target.value})}_handlePaletteChange(e){this._setParams("form",{paletteId:e.target.value})}_toggleOrientation(){this._setParams("form",{isPortrait:!this._state.isPortrait})}_toggleDarkMode(){this._setParams("form",{isDarkMode:!this._state.isDarkMode})}_resetToModelDefaults(){let e=this._state.model;if(!e)return;let s=this._getFirstValidPaletteId(e);this._setParams("form",{paletteId:s,isPortrait:!1,isDarkMode:!1})}_updateResetButton(){if(!this.elements.resetButton)return;let e=this._state.model;if(!e)return;let s=this._getFirstValidPaletteId(e),t=this.elements.paletteSelect.value===String(s),a=this._state.isPortrait===!1,i=this._state.isDarkMode===!1,o=t&&a&&i;this.elements.resetButton.disabled=o,o?(this.elements.resetButton.classList.add("opacity-50","cursor-default"),this.elements.resetButton.setAttribute("aria-disabled","true")):(this.elements.resetButton.classList.remove("opacity-50","cursor-default"),this.elements.resetButton.removeAttribute("aria-disabled"))}get _screenClasses(){let e=this._state.model,s=this._state.palette;if(!e)throw new Error("No model selected");let t=[];return t.push("screen"),s&&s.framework_class&&t.push(s.framework_class),e.css&&e.css.classes&&e.css.classes.device&&t.push(e.css.classes.device),e.css&&e.css.classes&&e.css.classes.size&&t.push(e.css.classes.size),this._state.isPortrait&&t.push("screen--portrait"),t.push("screen--1x"),this._state.isDarkMode&&t.push("screen--dark-mode"),t}get params(){return{modelName:this._state.model?.name,paletteId:this._state.palette?.id,isPortrait:this._state.isPortrait,isDarkMode:this._state.isDarkMode}}setParams(e){this._setParams("setParams",e)}_setParams(e,s){if(!s||typeof s!="object")throw new Error("params must be an object");let t=!1;if(s.modelName){let a=this.models.find(i=>i.name===s.modelName);if(a){this.elements.modelSelect.value=a.name,this._state.model=a,this._populateModelPalettes();let i=this._getFirstValidPaletteId(a);this.elements.paletteSelect.value=i,this._state.palette=this.palettes.find(o=>o.id===i),t=!0}}if(s.paletteId){let a=this.palettes.find(i=>i.id===s.paletteId);a&&(this.elements.paletteSelect.value=a.id,this._state.palette=a,t=!0)}return typeof s.isPortrait=="boolean"&&(this._state.isPortrait=s.isPortrait,this.elements.orientationText&&(this.elements.orientationText.textContent=this._state.isPortrait?"Portrait":"Landscape"),t=!0),typeof s.isDarkMode=="boolean"&&(this._state.isDarkMode=s.isDarkMode,this.elements.darkModeText&&(this.elements.darkModeText.textContent=this._state.isDarkMode?"Dark Mode":"Light Mode"),t=!0),t&&this._updateResetButton(),t&&e&&this._emitChangeEvent(e),t}get state(){return{screenClasses:this._screenClasses,...this._dimensions,...this._state}}get _dimensions(){let e=this._state.model,s=e.width/e.scale_factor,t=e.height/e.scale_factor;return this._state.isPortrait&&([s,t]=[t,s]),{width:s,height:t}}destroy(){this.elements.modelSelect.removeEventListener("change",this.handlers.modelChange),this.elements.paletteSelect.removeEventListener("change",this.handlers.paletteChange),this.elements.orientationToggle&&this.elements.orientationToggle.removeEventListener("click",this.handlers.orientationToggle),this.elements.darkModeToggle&&this.elements.darkModeToggle.removeEventListener("click",this.handlers.darkModeToggle),this.elements.resetButton&&this.elements.resetButton.removeEventListener("click",this.handlers.reset),this.formElement=null,this.elements=null,this.handlers=null,this.models=null,this.palettes=null,this._state=null}},P=f;return M(w);})();
TRMNLPicker=TRMNLPicker.default;
//# sourceMappingURL=trmnl-picker.min.js.map
